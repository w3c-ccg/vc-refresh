<!DOCTYPE html>
<html>
<head>
  <title>Verifiable Credential Refresh v0.5</title>
  <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
  <!--
    === NOTA BENE ===
    For the three scripts below, if your spec resides on dev.w3 you can check
    them out in the same tree and use relative links so that they'll work
    offline.
  -->

  <script class="remove"
    src="https://unpkg.com/browse/jquery/dist/jquery.min.js"></script>
  <script class="remove"
    src="https://www.w3.org/Tools/respec/respec-w3c"></script>

  <script class="remove" type="text/javascript">
var respecConfig = {
  // the W3C WG and public mailing list
  group: "credentials",
  wgPublicList: "public-credentials",

  // the specification's short name, as in http://www.w3.org/TR/short-name/
  shortName: "vc-refresh",

  // specification status (e.g., WD, LCWD, NOTE, etc.). If in doubt use ED.
  specStatus: "CG-DRAFT",

  // Editor's Draft URL
  latestVersion: "https://w3c-ccg.github.io/vc-refresh/",

  // subtitle for the spec
  subtitle: "A data model and protocol for refreshing Verifiable Credentials",

  // if you wish the publication date to be other than today, set this
  //publishDate:  "2021-08-03",

  // previously published draft, uncomment this and set its
  // YYYY-MM-DD date and its maturity status
  //previousPublishDate:  "2021-06-15",
  //previousMaturity:  "CR",

  // automatically allow term pluralization
  pluralize: true,

  lint: {
    "no-unused-dfns": false
  },
  // extend the bibliography entries
  xref: ["web-platform", "vc-data-model-2.0"],
  github: {
    repoURL: "https://github.com/w3c-ccg/vc-refresh/",
    branch: "main"
  },
  includePermalinks: false,

  // Uncomment these to use the respec extension that generates a list of
  //   normative statements:
  preProcess: [],
  postProcess: [],

  // list of specification editors
  editors: [
    {
      name: "Manu Sporny",
      url: "http://manu.sporny.org/",
      company: "Digital Bazaar",
      companyURL: "https://digitalbazaar.com/",
      w3cid: 41758
    }
  ],

  // list of specification authors
  authors: [{
      name: "Manu Sporny",
      url: "http://manu.sporny.org/",
      company: "Digital Bazaar",
      companyURL: "https://digitalbazaar.com/",
      w3cid: 41758
    },
    {
      name: "Dmitri Zagidulin",
      url: "https://github.com/dmitrizagidulin",
      company: "MIT DCC",
      companyURL: "https://digitalcredentials.mit.edu/"
    }
  ],

  otherLinks: [{
    key: "Related Documents",
    data: [{
      value: "Verifiable Credentials Data Model",
      href: "https://www.w3.org/TR/vc-data-model/"
    }, {
      value: "Verifiable Presentation Request",
      href: "https://w3c-ccg.github.io/vp-request-spec/"
    }, {
      value: "Verifiable Credentials API",
      href: "https://w3c-ccg.github.io/vc-api/"
    }]
  }],

  // extend the bibliography entries
  localBiblio: {
    "VCALM": {
      title: "Verifiable Credential API for Lifecycle Management",
      href: "https://w3c-ccg.github.io/vcalm/",
      status: "CG-DRAFT",
      publisher: "W3C Credentials Community Group"
    }
  }
};
  </script>
  <style>
code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre {
  overflow-x: auto;
  white-space: pre-wrap;
}
pre .highlight {
  font-weight: bold;
  color: Green;
}
pre .subject {
  font-weight: bold;
  color: RoyalBlue;
}
pre .property {
  font-weight: bold;
  color: DarkGoldenrod;
}
pre .comment {
  font-weight: bold;
  color: SteelBlue;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
code a[href] {
  color: inherit;
  border-bottom: none;
}
code a[href]:hover {
  border-bottom: 1px solid #c63501;
}
ol.algorithm {
  counter-reset: numsection;
  list-style-type: none;
}
ol.algorithm li {
  margin: 0.5em 0;
}
ol.algorithm li:before {
  font-weight: bold;
  counter-increment: numsection;
  content: counters(numsection, ".") ") ";
}
table.simple {
  border-collapse: collapse;
  margin: 25px 0;
  min-width: 75%;
  border: 1px solid #dddddd;
}
table.simple thead tr {
  background-color: #005a9c;
  color: #ffffff;
  text-align: left;
}
table.simple th,
table.simple td {
  padding: 12px 15px;
  vertical-align: top;
  text-align: left;
}
table.simple tbody tr {
  border-bottom: 1px solid #dddddd;
}
table.simple tbody tr:nth-of-type(even) {
  background-color: #00000008;
}
table.simple tbody tr:last-of-type {
  border-bottom: 2px solid #005a9c;
}
  </style>
</head>
<body data-cite="infra rfc3986">
  <section id='abstract'>

    <p>
Verifiable Credentials can expire. It is useful to provide instructions on
refreshing the credential for the times when expiration is imminent or has
already occurred. The refresh can be performed manually or, with the prior
consent of the credential holder, automatically.
    </p>
    <p>
This document specifies manual and automatic refresh mechanisms that  Verifiable
Credential issuers can utilize to enhance the experience when using their
credentials.
    </p>
  </section>

  <section id='sotd'>
    <p>
Comments regarding this document are welcome. Please file issues
directly on <a href="https://github.com/w3c-ccg/vc-refresh/issues/">GitHub</a>,
or send them
to <a href="mailto:public-credentials@w3.org">public-credentials@w3.org</a> (
<a href="mailto:public-credentials-request@w3.org?subject=subscribe">subscribe</a>,
<a href="https://lists.w3.org/Archives/Public/public-credentials/">archives</a>).
    </p>
  </section>

  <section class="informative">
    <h1>Introduction</h1>
    <p>
<a>Verifiable Credentials</a> can expire. It is useful to provide instructions on
refreshing the credential for the times when expiration is imminent or has
already occurred. The refresh can be performed manually or, with the prior
consent of the credential <a>holder</a>, automatically.
    </p>

    <section id="conformance">

     <p>
A conforming <dfn>refresh service implementation</dfn> MUST provide at least
one refresh protocol defined in Section [[[#refresh-protocol]]].
     </p>

     <p>
A conforming <dfn>refresh client implementation</dfn> MUST communicate with a
[=refresh service implementation=] using at least one refresh protocol defined
in Section [[[#refresh-protocol]]].
     </p>

      <p>
This document contains examples that contain JSON and JSON-LD content.
Some of these examples contain characters that are invalid, such as inline
comments (<code>//</code>) and the use of ellipsis (<code>...</code>) to denote
information that adds little value to the example. Implementers are cautioned to
remove this content if they desire to use the information as valid JSON
or JSON-LD.
      </p>

    </section>

    <section class="informative">
      <h2>Terminology</h2>

      <p>
  Terminology used throughout this document is defined in the
  <a data-cite="VC-DATA-MODEL-2.0#terminology">Terminology</a> section of the
  [[[VC-DATA-MODEL-2.0]]] specification.
      </p>

    </section>
  </section>

  <section>
    <h1>Refresh Data Model</h1>

    <p>
This specification utilizes the Verifiable Credentials data model
[[VC-DATA-MODEL]] and the
<a href="https://www.w3.org/TR/vc-data-model/#refreshing">Refreshing feature</a>
defined in that specification.
    </p>

    <section>
      <h2>The `refreshService` Property</h2>

      <p>
The refresh data model in this specification is expressed via the
<code>refreshService</code> property in a Verifiable Credential. The table
below provides the structure of the refresh service description.
      </p>

      <table class="simple">
        <thead>
          <tr>
            <th style="white-space: nowrap">Property</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
          <tr>
            <td>type</td>
            <td>
A REQUIRED string that MUST be set to `VerifiableCredentialInteractionService`.
            </td>
          </tr>
            <td>serviceEndpoint</td>
            <td>
A REQUIRED URL string, as defined by the <a
data-cite="VCALM#interaction-url-format">Interaction URL section</a> of the
[[[VCALM]]] specification, that MUST be used to initiate a credential refresh.
            </td>
          </tr>
          <tr>
            <td>validFrom</td>
            <td>
An OPTIONAL [[XMLSCHEMA11-2]] datetime value that specifies the earliest moment
in time that a refresh can be performed.
            </td>
          </tr>
          <tr>
            <td>validUntil</td>
            <td>
An OPTIONAL [[XMLSCHEMA11-2]] datetime value that specifies the latest moment
in time that a refresh can be performed.
            </td>
          </tr>
        </tbody>
      </table>

      <p>
The example below demonstrates the use of the data model described in this
section to specify a manual refresh service:
      </p>

      <pre class="example nohighlight"
        title="Verifiable Credential specifying a manual credential refresh">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2",
    "https://w3id.org/vc-refresh-service/v2rc1"
  ],
  "id": "http://university.example/credentials/3732",
  "type": ["VerifiableCredential", "UniversityDegreeCredential"],
  "issuer": "https://university.example/issuers/14",
  "validFrom": "2025-01-01T19:23:24Z",
  "validUntil": "2035-01-01T19:23:24Z",
  "credentialSubject": {
    "id": "did:example:ebfeb1f712ebc6f1c276e12ec21",
    "degree": {
      "type": "BachelorDegree",
      "name": "Bachelor of Science and Arts"
    }
  },
  <span class="highlight">"refreshService": {
    "type": "VerifiableCredentialInteractionService",
    "serviceEndpoint": "https://university.example/interactions/3732?iuv=1",
    "validFrom": "2034-09-01T19:23:24Z"
  }</span>
}
      </pre>

      <p>
The example below demonstrates the use of the data model described in this
section to specify an automatic refresh service:
      </p>

      <pre class="example nohighlight"
        title="Verifiable Credential specifying an automatic credential refresh">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2",
    "https://w3id.org/vc-refresh-service/v2rc1"
  ],
  "id": "http://university.example/credentials/3732",
  "type": ["VerifiableCredential", "UniversityDegreeCredential"],
  "issuer": "https://university.example/issuers/14",
  "validFrom": "2025-01-01T19:23:24Z",
  "validUntil": "2035-01-01T19:23:24Z",
  "credentialSubject": {
    "id": "did:example:ebfeb1f712ebc6f1c276e12ec21",
    "degree": {
      "type": "BachelorDegree",
      "name": "Bachelor of Science and Arts"
    }
  },
  <span class="highlight">"refreshService": {
    "type": "VerifiableCredentialInteractionService",
    "serviceEndpoint": "https://university.example/interactions/748?iuv=1",
    "validFrom": "2033-09-01T19:23:24Z",
    "validUntil": "2034-01-01T19:23:24Z"
  }</span>
}
      </pre>

      <p>
Performing an HTTP POST with an empty object on the
`https://university.example/interactions/748?iuv=1`
will initiate a presentation request using the [[[VCALM]]] specification.
      </p>

    </section>

    <section>
      <h2>The `RefreshCredential` Class</h2>
    </section>

  </section>

  <section>
    <h1>Refresh Protocol</h1>

    <p>
This section details the protocols that can be used to refresh a credential. In
general, all refresh protocols in this specification implement the
following general pattern.
    </p>

    <img src="diagrams/refresh-flow.svg">

    <section class="algorithm">
      <h2>Manual Refresh</h2>

      <p>
The manual protocol is used when an <a>issuer</a> uses a refresh prodedure that
is non-automatable or requires an interactive exchange with the
<a>holder</a>. The details of the protocol are defined in the
<a data-cite="VCALM#initiating-interactions">
Initiating Interactions section</a> specified of the [[[VCALM]]] specification.
      </p>

      <p>
The example below demonstrates the requests and responses required to perform a
manual refresh. The [=holder=]'s wallet initiates a refresh using the
`serviceEndpoint` URL noting that it supports both manual and automated
workflows.
      </p>

      <pre class="example"
        title="Step 1 (holder->issuer): Initiate a refresh interaction">
GET /interactions/3732?iuv=1 HTTP/1.1
Host: university.example
Accept: application/json
      </pre>

      <p>
The refresh service responds with a [[[VCALM]]]
<a data-cite="VCALM#dfn-exchange">exchange</a> that will provide next steps.
      </p>

      <pre class="example"
        title="Step 2 (issuer->holder): Provide exchange URL">
HTTP/1.1 200 OK
Date: Fri, 27 Sep 2025 12:03:57 GMT
Content-Type: application/json

{
  "protocols": {
    "vcapi": "https://university.example/workflows/123/exchanges/987"
  }
}
      </pre>

      <p>
The [=holder=] starts the exchange by posting an empty object.
      </p>

      <pre class="example"
        title="Step 3 (holder->issuer): Initiate exchange to perform manual refresh">
POST /workflows/123/exchanges/987 HTTP/1.1
Host: university.example
Accept: application/json

{}
      </pre>

      <p>
The [=issuer=] provides a `redirectUrl` which is a signal to the wallet software
that the rest of the flow needs to be performed in a web browser.
      </p>

      <pre class="example"
        title="Step 4 (issuer->holder): Provide redirect URL for holder to manually engage">
HTTP/1.1 200 OK
Date: Fri, 27 Sep 2025 12:03:58 GMT
Content-Type: application/json

{
  "redirectUrl": "https://university.example/get-your-degree/3829"
}
      </pre>

      <p>
At this point, the [=holder=] is redirected to the provided website URL
(`https://university.example/get-your-degree/3829`) and interacts with the
website to get an updated degree as a [=verifiable credential=].
      </p>

    </section>

    <section class="algorithm">
      <h2>Automatic Refresh</h2>

      <p>
The automatic refresh protocol is used when an <a>issuer</a> uses a refresh
procedure that can be automated with the <a>holder</a>'s software. The details
of the protocol are defined in the
<a data-cite="VCALM#initiating-interactions">
Initiating Interactions section</a> specified of the [[[VCALM]]] specification.
      </p>

      <p>
The example below demonstrates the requests and responses required to perform an
automatic refresh. The [=holder=]'s wallet initiates a refresh using the
`serviceEndpoint` URL noting that it supports both manual and automated
workflows.
      </p>

      <pre class="example"
        title="Step 1 (holder->issuer): Initiate a refresh interaction">
GET /interactions/748?iuv=1 HTTP/1.1
Host: university.example
Accept: application/json
      </pre>

      <p>
The refresh service responds with a [[[VCALM]]]
<a data-cite="VCALM#dfn-exchange">exchange</a> that will provide next steps.
      </p>

      <pre class="example"
        title="Step 2 (issuer->holder): Provide exchange URL">
HTTP/1.1 200 OK
Date: Fri, 27 Sep 2025 12:03:57 GMT
Content-Type: application/json

{
  "protocols": {
    "vcapi": "https://university.example/workflows/748/exchanges/987"
  }
}
      </pre>

      <p>
The [=holder=] starts the exchange by posting an empty object.
      </p>

      <pre class="example"
        title="Step 3 (holder->issuer): Initiate exchange to perform an automated refresh">
POST /workflows/748/exchanges/987 HTTP/1.1
Host: university.example
Accept: application/json

{}
      </pre>

      <p>
The refresh service responds with an automatic refresh request:
      </p>

      <pre class="example"
        title="Step 4 (issuer->holder): Issuer requests old university degree">
HTTP/1.1 200 OK
Date: Fri, 27 Sep 2025 12:03:58 GMT
Content-Type: application/json

{
  "verifiablePresentationRequest": {
    "query": [{
        "type": "DIDAuthentication",
        "acceptedMethods": [{"method": "example"}],
        "acceptedCryptosuites": [{"cryptosuite": "ecdsa-rdfc-2019"}]
        }, {
        "type": "QueryByExample",
        "credentialQuery": {
          "reason": "We need to see your existing University Degree credential.",
          "example": {
            "@context": [
              "https://www.w3.org/ns/credentials/v2",
              "https://www.w3.org/ns/credentials/examples/v2"
            ],
            "type": "UniversityDegreeCredential"
          }
        }
      }],
      "challenge": "3182bdea-63d9-11ea-b6de-3b7c1404d57f",
      "domain": "university.example"
    }
  }
}
      </pre>

      <p>
The [=holder=]'s software then responds with the appropriate credential:
      </p>

      <pre class="example"
        title="Step 5 (holder->issuer): Holder presents old university degree">
POST /workflows/748/exchanges/987 HTTP/1.1
Host: university.example
Content-Type: application/json
Accept: application/json, */*
Accept-Encoding: gzip, deflate

{
  "verifiablePresentation": {
    "@context": [
      "https://www.w3.org/ns/credentials/v2",
      "https://www.w3.org/ns/credentials/examples/v2",
      "https://w3id.org/vc-refresh-service/v2rc1"
    ],
    "type": ["VerifiablePresentation"],
    "holder": "did:example:ebfeb1f712ebc6f1c276e12ec21",
    "verifiableCredential": [{
      "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2",
        "https://w3id.org/vc-refresh-service/v2rc1"
      ],
      "id": "http://university.example/credentials/3732",
      "type": [
        "VerifiableCredential",
        "UniversityDegreeCredential"
      ],
      "issuer": "https://university.example/issuers/14",
      "validFrom": "2024-01-01T19:23:24Z",
      "validUntil": "2034-01-01T19:23:24Z",
      "credentialSubject": {
        "id": "did:example:ebfeb1f712ebc6f1c276e12ec21",
        "degree": {
          "type": "BachelorDegree",
          "name": "Bachelor of Science and Arts"
        }
      },
      "refreshService": {
        "type": "VerifiableCredentialInteractionService",
        "serviceEndpoint": "https://university.example/interactions/92838?iuv=1",
        "validFrom": "2024-09-01T19:23:24Z",
        "validUntil": "2034-09-01T19:23:24Z"
      }
      "proof": {
        "type": "DataIntegrityProof",
        "cryptosuite": "ecdsa-rdfc-2019",
        "created": "2025-01-05T17:59:45Z",
        "verificationMethod": "https://university.example/issuers/14#key-1",
        "proofPurpose": "assertionMethod",
        "proofValue": "z2aArNcQKX9aqYK7GRZmV7c9xfGuwB5YAXhkYY9DTvLdTCQEsXaNpz1G
                      ZL9XDXdFQGT27WB68e2Y3wo9k75rka8oo"
      }
    }],
    "proof": {
      "type": "DataIntegrityProof",
      "cryptosuite": "ecdsa-rdfc-2019",
      "created": "2034-06-15T16:37:12Z",
      "verificationMethod": "did:example:76e12ec712ebc6f1c221ebfeb1f#key-1",
      "proofPurpose": "authentication",
      "challenge": "3182bdea-63d9-11ea-b6de-3b7c1404d57f",
      "domain": "university.example",
      "proofValue": "z4aU6NSpnCvnjJqzAPw3cqJ1LKoWimEWxKz7StJYzwaZE2a3QAuK8vcq
                    umwr6uabr7RshvjH1yTv1fTuhPUii1fN"
    }
  }
}
      </pre>

      <pre class="example"
        title="Step 6 (issuer->holder): Issuer provides updated university degree">
HTTP/1.1 200 OK
Date: Fri, 27 Sep 2025 12:03:59 GMT
Content-Type: application/json

{
  "verifiablePresentation": {
    "@context": [
      "https://www.w3.org/ns/credentials/v2",
      "https://www.w3.org/ns/credentials/examples/v2",
      "https://w3id.org/vc-refresh-service/v2rc1"
    ],
    "type": ["VerifiablePresentation"],
    "verifiableCredential": [{
      "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2",
        "https://w3id.org/vc-refresh-service/v2rc1"
      ],
      "id": "http://university.example/credentials/3732",
      "type": [
        "VerifiableCredential",
        "UniversityDegreeCredential"
      ],
      "issuer": "https://university.example/issuers/14",
      "validFrom": "2024-01-01T19:23:24Z",
      "validUntil": "2044-06-14T18:37:12Z",
      "credentialSubject": {
        "id": "did:example:ebfeb1f712ebc6f1c276e12ec21",
        "degree": {
          "type": "BachelorDegree",
          "name": "Bachelor of Science and Arts"
        }
      },
      "refreshService": {
        "type": "VerifiableCredentialInteractionService",
        "serviceEndpoint": "https://university.example/interactions/892349?iuv=1",
        "validFrom": "2044-06-01T19:23:24Z"
      },
      "proof": {
        "type": "DataIntegrityProof",
        "cryptosuite": "ecdsa-rdfc-2019",
        "created": "2034-06-14T18:37:12Z",
        "verificationMethod": "https://university.example/issuers/14#key-1",
        "proofPurpose": "assertionMethod",
        "proofValue": "z2aArNcQKX9aqYK7GRZmV7c9xfGuwB5YAXhkYY9DTvLdTCQEsXaNpz1G
                      ZL9XDXdFQGT27WB68e2Y3wo9k75rka8oo"
      }
    }]
  }
}
      </pre>

    </section>

  </section>

</body>
</html>
